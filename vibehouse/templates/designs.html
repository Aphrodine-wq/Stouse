{% extends "base.html" %}
{% block title %}Design Options — VibeHouse{% endblock %}

{% block body %}
<div class="page-container fade-in-up">
  <div class="page-header">
    <a href="/projects/{{ project_id }}" class="btn btn-plain">&larr; Project</a>
    <h1>Design Options</h1>
    <p class="text-secondary">Review the AI-generated designs and select your favorite</p>
  </div>

  <div id="designsLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading designs...</p>
  </div>

  <div id="noDesigns" class="empty-state" style="display:none;">
    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>
    <h3>No designs yet</h3>
    <p class="text-secondary">Submit your vibe description from the project page to generate designs.</p>
    <a href="/projects/{{ project_id }}" class="btn btn-primary">Go to Project</a>
  </div>

  <div id="designGrid" class="design-grid" style="display:none;"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
const PROJECT_ID = '{{ project_id }}';
const token = localStorage.getItem('access_token');
if (!token) window.location.href = '/login';
const headers = {'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json'};

async function loadDesigns() {
  try {
    const resp = await fetch(`/api/v1/projects/${PROJECT_ID}/designs`, {headers});
    document.getElementById('designsLoading').style.display = 'none';
    if (!resp.ok) { document.getElementById('noDesigns').style.display = 'flex'; return; }
    const data = await resp.json();
    const designs = data.designs || data;
    if (!designs || !designs.length) {
      document.getElementById('noDesigns').style.display = 'flex';
      return;
    }

    const grid = document.getElementById('designGrid');
    grid.style.display = 'grid';
    const tiers = ['Budget-Friendly', 'Balanced', 'Premium'];
    const colors = ['var(--sys-green)', 'var(--sys-blue)', 'var(--sys-purple)'];

    designs.forEach((d, i) => {
      const tier = tiers[i] || 'Option ' + (i + 1);
      const color = colors[i] || 'var(--sys-blue)';
      const meta = d.metadata || {};
      grid.innerHTML += `
        <div class="design-card">
          <div class="design-card-badge" style="background: ${color};">${tier}</div>
          <div class="design-card-body">
            <h3>${d.artifact_type || 'Floor Plan'}</h3>
            <p class="text-secondary">${meta.summary || 'AI-generated design option'}</p>
            <div class="design-meta-grid">
              ${meta.total_sqft ? `<div class="design-meta-item"><span class="meta-label">Sq Ft</span><span class="meta-val">${meta.total_sqft.toLocaleString()}</span></div>` : ''}
              ${meta.rooms ? `<div class="design-meta-item"><span class="meta-label">Rooms</span><span class="meta-val">${meta.rooms.length || '—'}</span></div>` : ''}
              ${meta.estimated_cost ? `<div class="design-meta-item"><span class="meta-label">Est. Cost</span><span class="meta-val">$${Number(meta.estimated_cost).toLocaleString()}</span></div>` : ''}
            </div>
          </div>
          <div class="design-card-footer">
            <button class="btn btn-primary btn-full" onclick="selectDesign('${d.id}')">Select This Design</button>
          </div>
        </div>
      `;
    });
  } catch (e) {
    document.getElementById('designsLoading').style.display = 'none';
    document.getElementById('noDesigns').style.display = 'flex';
  }
}

async function selectDesign(designId) {
  try {
    const resp = await fetch(`/api/v1/projects/${PROJECT_ID}/designs/${designId}/select`, {
      method: 'POST', headers,
    });
    if (resp.ok) {
      window.location.href = `/projects/${PROJECT_ID}`;
    }
  } catch (e) { console.error(e); }
}

loadDesigns();
</script>
{% endblock %}
